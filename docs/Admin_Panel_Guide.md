# IndexedDB 管理后台

这是一个为健康日历应用创建的 IndexedDB 管理后台，提供完整的数据库管理功能。

## 功能特性

### 📊 数据库概览
- 实时显示数据库基本信息（名称、版本、存储数量、记录总数）
- 显示估算的数据库大小
- 各个对象存储的详细统计信息
- 最后修改时间追踪

### 🗃️ 记录管理
- **多存储支持**: 管理所有对象存储（users、stoolRecords、mealRecords、myRecords）
- **搜索功能**: 全文搜索记录内容
- **排序功能**: 按不同字段排序（ID、创建时间、更新时间等）
- **CRUD操作**: 
  - 查看记录详情（JSON格式）
  - 添加新记录
  - 编辑现有记录
  - 软删除（设置delFlag）
  - 永久删除
- **数据验证**: 自动验证记录格式

### 🔍 健康检查
- 数据库版本检查
- 空存储检测
- 大数据量警告
- 数据库大小监控
- 健康状态总览和建议

### 🛠️ 维护工具
- **备份和恢复**:
  - 完整数据库导出（JSON格式）
  - 导入备份文件
  - 元数据包含（导出时间、记录数量等）
- **清理工具**:
  - 清空单个对象存储
  - 重置整个数据库
- **其他工具**:
  - 刷新数据库信息
  - 快速访问主应用

## 技术实现

### 架构设计
```
/admin
├── page.tsx              # 主管理界面
└── /lib/adminService.ts   # 数据库管理服务
```

### 核心组件
- **IndexedDBAdmin**: 主管理界面组件
- **IndexedDBAdminService**: 数据库操作服务类

### 主要特性
- **类型安全**: 完整的 TypeScript 类型定义
- **错误处理**: 完善的错误处理和用户反馈
- **响应式设计**: 适配桌面和移动设备
- **实时更新**: 操作后自动刷新数据
- **数据验证**: 针对不同存储的特定验证规则

## 访问方式

### 1. 直接访问
访问 `/admin` 路径直接进入管理后台

### 2. 从主应用访问
在健康日历主应用中：
1. 点击底部导航的"设置"标签
2. 在常规设置部分找到"管理面板"
3. 点击"打开"按钮

## 安全注意事项

⚠️ **重要提醒**:
- 这是一个强大的数据库管理工具
- 可以直接操作用户的健康数据
- 删除操作不可恢复
- 建议仅在开发和调试时使用
- 生产环境中应该限制访问权限

## 数据库结构

### 对象存储说明
- **users**: 用户信息存储
- **stoolRecords**: 排便记录存储
- **mealRecords**: 饮食记录存储
- **myRecords**: 自定义健康记录存储

### 基础记录结构
所有记录都继承自 `BaseRecord` 接口：
```typescript
interface BaseRecord {
  id: string
  userId: string
  createdAt: string
  updatedAt: string
  delFlag: boolean
}
```

## 使用指南

### 基本操作流程
1. **查看概览**: 在"数据库概览"标签查看整体状态
2. **管理记录**: 在"记录管理"标签进行增删改查
3. **健康检查**: 定期运行健康检查确保数据库状态良好
4. **备份数据**: 使用维护工具定期备份重要数据

### 最佳实践
- 操作前先查看健康检查结果
- 重要操作前先备份数据
- 定期清理软删除的记录
- 监控数据库大小增长

## 故障排除

### 常见问题
1. **数据库打开失败**: 检查是否有其他标签页在使用应用
2. **版本不匹配**: 考虑升级数据库版本
3. **记录格式错误**: 检查JSON格式和必需字段
4. **性能问题**: 考虑清理旧数据或优化查询

### 紧急恢复
如果数据出现问题：
1. 停止所有操作
2. 使用最近的备份文件恢复
3. 重新运行健康检查
4. 验证数据完整性

## 更新日志

### v1.0.0 (当前版本)
- ✅ 完整的数据库管理界面
- ✅ 多标签页设计（概览、记录、健康、工具）
- ✅ 完整的CRUD操作
- ✅ 搜索和排序功能
- ✅ 健康检查系统
- ✅ 备份和恢复功能
- ✅ 数据验证机制
- ✅ 响应式设计
- ✅ 错误处理和用户反馈

### 未来计划
- [ ] 数据可视化图表
- [ ] 批量操作功能
- [ ] 高级查询过滤器
- [ ] 操作日志记录
- [ ] 数据导出格式扩展（CSV、Excel）
- [ ] 自动备份调度
- [ ] 权限管理系统

## 技术栈

- **框架**: Next.js 15
- **语言**: TypeScript
- **UI**: React + Tailwind CSS
- **组件**: shadcn/ui
- **数据库**: IndexedDB
- **图标**: Lucide React

## 开发说明

如需修改或扩展功能，主要文件位置：
- 界面组件: `/app/admin/page.tsx`
- 业务逻辑: `/lib/adminService.ts`
- 数据库版本: `/lib/dbVersion.ts`
- 类型定义: `/type/baserecord.tsx`
